<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Khula:wght@400;700&display=swap" rel="stylesheet">
  <title>Trash Panda - Home</title>
  <style>
    /* Base styles */
    body {
      font-family: 'Khula', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #FDF6E3;
      color: #333;
    }

    /* Header/Navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #F2C1BD;
      padding: 15px 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .logo-container {
      display: flex;
      align-items: center;
    }

    .logo-icon {
      height: 40px;
      margin-right: 10px;
    }

    .logo-text {
      font-size: 24px;
      font-weight: bold;
      color: #3E8440;
    }

    .nav-links {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .nav-links li {
      margin-left: 30px;
    }

    .nav-links a {
      color: #3E8440;
      text-decoration: none;
      font-size: 20px;
      font-weight: bold;
      text-transform: uppercase;
    }

    /* Main content layout */
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto auto;
      gap: 20px;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .section {
      background-color: #FDF6E3;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #3E8440;
      min-height: 250px;
    }

    .section h2 {
      color: #3E8440;
      font-size: 28px;
      margin-top: 0;
      margin-bottom: 15px;
      border-bottom: 2px solid #3E8440;
      padding-bottom: 5px;
    }

    .want {
      grid-column: 1;
      grid-row: 1;
    }

    .have {
      grid-column: 2;
      grid-row: 1;
    }

    .map-container {
      grid-column: span 2;
      grid-row: 2;
      min-height: 250px;
    }

    .buttons-container {
      grid-column: span 2;
      grid-row: 3;
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }

    /* Buttons */
    .btn {
      background-color: #B7E1A1;
      color: #3E8440;
      padding: 12px 25px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 200px;
      text-align: center;
    }

    .btn:hover {
      background-color: #3E8440;
      color: white;
    }

    .createPostButton,
    .createPostButton2 {
      background-color: #B7E1A1;
      color: #3E8440;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
      display: inline-block;
      position: relative;
      right: -15px;
    }

    .createPostButton:hover,
    .createPostButton2:hover {
      background-color: #3E8440;
      color: white;
    }

    /* Lists */
    #userList,
    #userList2,
    #matchResults {
      list-style-type: none;
      padding-left: 10px;
      margin-top: 15px;
    }

    #userList li,
    #userList2 li,
    #matchResults li {
      padding: 8px 0;
      border-bottom: 1px solid rgba(62, 132, 64, 0.2);
    }

    /* Match styles */
    .match-item {
      background-color: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border-left: 4px solid #3E8440;
    }

    .match-header {
      font-size: 18px;
      margin-bottom: 10px;
      color: #3E8440;
    }

    .match-details {
      margin-left: 10px;
    }

    .match-details p {
      margin: 5px 0;
    }

    .btn-contact {
      background-color: #3E8440;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
    }

    .btn-contact:hover {
      background-color: #2a5c2d;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      overflow-y: auto;
    }

    .modal.visible {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 50px;
    }

    .modal-content,
    .modal-content2 {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      width: 90%;
      max-width: 450px;
      max-height: 80vh;
      overflow-y: auto;
      margin: 0 auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .modal-content h2,
    .modal-content2 h2 {
      color: #3E8440;
      text-align: center;
      margin-top: 0;
      margin-bottom: 20px;
      border-bottom: 2px solid #3E8440;
      padding-bottom: 10px;
    }

    /* Form styling */
    form label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #3E8440;
    }

    form input,
    form select {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 16px;
    }

    .modalBtn,
    .modalBtn2 {
      background-color: #3E8440;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 10px;
      font-size: 16px;
    }

    .close-modal,
    .close-modal2 {
      background-color: #f44336;
    }

    /* Status message */
    .status-message {
      padding: 12px;
      margin: 15px 0;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
    }

    .status-success {
      background-color: #d4edda;
      color: #155724;
    }

    .status-error {
      background-color: #f8d7da;
      color: #721c24;
    }

    /* Recipes container */
    #recipes-container {
      margin-top: 25px;
      padding: 20px;
      background-color: #FDF6E3;
      border-radius: 10px;
      border: 2px solid #3E8440;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    #recipes-container h2 {
      color: #3E8440;
      border-bottom: 2px solid #3E8440;
      padding-bottom: 10px;
    }

    .recipe-card {
      background-color: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .recipe-card h3 {
      color: #3E8440;
      margin-top: 0;
    }

    .recipe-card h4 {
      color: #3E8440;
      margin-bottom: 5px;
    }

    .recipe-card ul {
      padding-left: 20px;
    }

    /* Loading indicator */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(62, 132, 64, 0.3);
      border-radius: 50%;
      border-top-color: #3E8440;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Utility classes */
    .hidden {
      display: none;
    }

    /* Media queries */
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }

      .want,
      .have {
        grid-column: 1;
      }

      .have {
        grid-row: 2;
      }

      .map-container {
        grid-column: 1;
        grid-row: 3;
      }

      .buttons-container {
        grid-column: 1;
        grid-row: 4;
        flex-direction: column;
        align-items: center;
      }

      .nav-links li {
        margin-left: 15px;
      }

      .nav-links a {
        font-size: 16px;
      }
    }

    .delete-button-share {
      background: none;
      border: none;
    }
    .delete-button-want {
      background: none;
      border: none;
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="logo-container">
      <img src="./racoon_yellow.svg" alt="Raccoon Icon" class="logo-icon">
      <span class="logo-text">Trash Panda</span>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">PROFILE</a></li>
      <li><a href="home.html">HOME</a></li>
    </ul>
  </nav>

  <div class="container">
    <div class="section want">
      <h2>WANT</h2>
      <ul id="userList">
        <li>Loading...</li>
      </ul>
      <button class="createPostButton">Create new entry</button>
    </div>
    <div class="section have">
      <h2>HAVE</h2>
      <ul id="userList2">
        <li>Loading...</li>
      </ul>
      <button class="createPostButton2">Create new entry</button>
    </div>
    <div class="section map-container">
      <h2>NEAR YOU</h2>
      <ul id="matchResults"></ul>
    </div>
    <div class="buttons-container">
      <button class="btn find-recipes">Find Recipes!</button>
      <button class="btn find-matches">Find Matches!</button>
    </div>
    <div id="status-container" class="hidden status-message"></div>
  </div>

  <div id="recipes-container" class="hidden">
    <h2>RECIPES</h2>
    <div id="recipes-list"></div>
  </div>

  <!-- Share Modal -->
  <div id="createPostModal2" class="modal hidden">
    <div class="modal-content2">
      <h2>Create New Share Entry</h2>
      <form id="postForm2">
        <label for="foodName2">Food Name:</label>
        <input type="text" id="foodName2" name="foodName" required>

        <label for="expiryDate2">Expiry Date:</label>
        <input type="date" id="expiryDate2" name="expiryDate" required>

        <label for="quantity2">Quantity:</label>
        <input type="number" id="quantity2" name="quantity" min="1" required>

        <label for="units2">Units:</label>
        <select id="units2" name="units">
          <option value="UNIT">Units</option>
          <option value="GRAM">Grams</option>
          <option value="KILOGRAM">Kilograms</option>
          <option value="MILLILITER">Milliliters</option>
          <option value="LITER">Liters</option>
          <option value="TSP">Teaspoon</option>
          <option value="TBSP">Tablespoon</option>
          <option value="CUP">Cup</option>
          <option value="PIECE">Pieces</option>
          <option value="PACK">Pack</option>
          <option value="BOTTLE">Bottle</option>
          <option value="CAN">Can</option>
          <option value="BOX">Box</option>
          <option value="BAG">Bag</option>
          <option value="JAR">Jar</option>
        </select>

        <button type="submit" class="modalBtn2">Submit</button>
        <button type="button" class="modalBtn close-modal2">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Want Modal -->
  <div id="createPostModal" class="modal hidden">
    <div class="modal-content">
      <h2>Create New Want Entry</h2>
      <form id="postForm">
        <label for="foodName">Food Name:</label>
        <input type="text" id="foodName" name="foodName" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" min="1" value="1" required>

        <label for="units">Units:</label>
        <select id="units" name="units">
          <option value="UNIT">Units</option>
          <option value="GRAM">Grams</option>
          <option value="KILOGRAM">Kilograms</option>
          <option value="MILLILITER">Milliliters</option>
          <option value="LITER">Liters</option>
          <option value="TSP">Teaspoon</option>
          <option value="TBSP">Tablespoon</option>
          <option value="CUP">Cup</option>
          <option value="PIECE">Pieces</option>
          <option value="PACK">Pack</option>
          <option value="BOTTLE">Bottle</option>
          <option value="CAN">Can</option>
          <option value="BOX">Box</option>
          <option value="BAG">Bag</option>
          <option value="JAR">Jar</option>
        </select>

        <button type="submit" class="modalBtn">Submit</button>
        <button type="button" class="modalBtn close-modal">Cancel</button>
      </form>
    </div>
  </div>

  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <h2>Are you sure you want to delete this item?</h2>
      <p id="modal-item-name"></p>
      <div class="buttons-container">
        <button id="confirm-delete" class="modalBtn">Yes</button>
        <button id="cancel-delete" class="close-modal modalBtn">No</button>
      </div>
    </div>
  </div>

  <script>
    // Get the current username from localStorage
    const username = localStorage.getItem("username") || "christine";

    // API base URL
    const API_BASE_URL = "http://localhost:4567";

    // Load user's sharelist and wantlist when page loads
    document.addEventListener("DOMContentLoaded", function () {
      console.log("Loading data for user:", username);
      loadLists();
    });

    async function loadLists() {
      try {
        console.log("Loading lists for user:", username);

        // Fetch sharelist data
        const shareResponse = await fetch(`${API_BASE_URL}/sharelist/${username}`);
        let shareList = [];
        if (shareResponse.ok) {
          shareList = await shareResponse.json();
          console.log("ShareList loaded:", shareList);
        } else {
          console.log("No sharelist found, status:", shareResponse.status);
        }

        // Fetch wantlist data
        const wantResponse = await fetch(`${API_BASE_URL}/wantlist/${username}`);
        let wantList = [];
        if (wantResponse.ok) {
          wantList = await wantResponse.json();
          console.log("WantList loaded:", wantList);
        } else {
          console.log("No wantlist found, status:", wantResponse.status);
        }

        // Update UI
        displayShareList(shareList);
        displayWantList(wantList);
      } catch (error) {
        console.error("Error loading lists:", error);
      }
    }

    function displayWantList(wantList) {
      const wantListElement = document.getElementById("userList");

      if (!wantList || wantList.length === 0) {
        wantListElement.innerHTML = "<li>No items in your want list</li>";
        return;
      }

      wantListElement.innerHTML = wantList.map(item => {
        const itemName = item.item ? item.item.name : "Unknown item";
        const qty = item.qty || 1;
        const unit = (item.item && item.item.qtyType) ? item.item.qtyType.toLowerCase() : "units";

        return `<li>${itemName} - ${qty} ${unit}
    <button class="delete-button-want" data-item-name1="${item.item.name}">&#x274c;</button>
    </li>`;
      }).join("");

    const deleteButtons = document.querySelectorAll('.delete-button-want');
    deleteButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const itemName = e.target.getAttribute('data-item-name1');
        const modal = document.getElementById('delete-modal');
        const modalItemName = document.getElementById('modal-item-name');
        const confirmDeleteButton = document.getElementById('confirm-delete');
        const cancelDeleteButton = document.getElementById('cancel-delete');

        modalItemName.textContent = `Are you sure you want to delete ${itemName}?`;

        modal.classList.add('visible');

        confirmDeleteButton.onclick = async () => {
          try {
            const response = await fetch(`${API_BASE_URL}/wantlist`, {
              method: 'DELETE',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                username: username,
                item: { name: itemName },
              }),
            });

            if (response.ok) {
              console.log(`${itemName} deleted successfully.`);
              e.target.closest('li').remove();
            } else {
              console.log(`Error deleting ${itemName}`);
            }
          } catch (error) {
            console.error('Error:', error);
          }
          modal.classList.remove('visible');
        };

        cancelDeleteButton.onclick = () => {
          modal.classList.remove('visible');
        };
      });
    });
    }

    function displayShareList(shareList) {
      const shareListElement = document.getElementById("userList2");

      if (!shareList || shareList.length === 0) {
        shareListElement.innerHTML = "<li>No items in your share list</li>";
        return;
      }

    function showStatus(message, isSuccess) {
      const statusContainer = document.getElementById("status-container");
      statusContainer.textContent = message;
      statusContainer.className = isSuccess ? "status-message status-success" : "status-message status-error";
      statusContainer.classList.remove("hidden");

      // Hide status after 3 seconds
      setTimeout(() => {
        statusContainer.classList.add("hidden");
      }, 3000);
    }

    // Find Recipes button handler
    document.querySelector(".find-recipes").addEventListener("click", async () => {
      try {
        document.querySelector(".find-recipes").innerHTML = "Finding Recipes... <span class='loading'></span>";

        const response = await fetch(`${API_BASE_URL}/recipes/${username}`);

        document.querySelector(".find-recipes").innerHTML = "Find Recipes!";

        if (response.ok) {
          const recipes = await response.json();
          displayRecipes(recipes);
          showStatus("Recipes generated successfully!", true);
        } else {
          showStatus("Could not find recipes with your ingredients.", false);
        }
      } catch (error) {
        console.error("Error finding recipes:", error);
        document.querySelector(".find-recipes").innerHTML = "Find Recipes!";
        showStatus("Error connecting to recipe service.", false);
      }
    });

    function displayRecipes(recipeText) {
      const recipesContainer = document.getElementById("recipes-container");
      const recipesList = document.getElementById("recipes-list");

      if (!recipeText || recipeText.includes("No recipes could be generated") || recipeText.includes("Failed to generate recipes")) {
        recipesList.innerHTML = "<p>No recipes found with your current ingredients.</p>";
        recipesContainer.classList.remove("hidden");
        return;
      }

      // Split the recipes by the separator line
      const recipes = recipeText.split("<br><br>----<br><br>");

      // Create recipe cards for each recipe
      recipesList.innerHTML = recipes.map(recipe => {
        // Clean up the recipe text
        const cleanedRecipe = recipe.trim();

        // Create a styled recipe card
        return `
      <div class="recipe-card">
        ${cleanedRecipe}
      </div>
    `;
      }).join("");

      recipesContainer.classList.remove("hidden");
    }

    // Also update the Find Recipes button handler to handle plain text:
    document.querySelector(".find-recipes").addEventListener("click", async () => {
      try {
        document.querySelector(".find-recipes").innerHTML = "Finding Recipes... <span class='loading'></span>";

        const response = await fetch(`${API_BASE_URL}/recipes/${username}`);

        document.querySelector(".find-recipes").innerHTML = "Find Recipes!";

        if (response.ok) {
          const recipeText = await response.text(); // Changed from json() to text()
          displayRecipes(recipeText);
          showStatus("Recipes generated successfully!", true);
        } else {
          showStatus("Could not find recipes with your ingredients.", false);
        }
      } catch (error) {
        console.error("Error finding recipes:", error);
        document.querySelector(".find-recipes").innerHTML = "Find Recipes!";
        showStatus("Error connecting to recipe service.", false);
      }
    });

    // Function to display matches with contact information
    function displayMatches(matches) {
      const matchResultsElement = document.getElementById("matchResults");

      if (matches.length === 0) {
        matchResultsElement.innerHTML = "<li>No matches found in your area.</li>";
        return;
      }

      // Create a more detailed display with contact information
      matchResultsElement.innerHTML = matches.map(match => {
        const userName = match.user.firstName || match.user.userName;
        const distance = match.distance.toFixed(1);
        const contact = match.user.contact || "No contact information available";

        // List what they have and you want
        const theirShareItems = match.user.shareList ? match.user.shareList.map(item => {
          const itemName = item.item ? item.item.name : "Unknown item";
          const qty = item.qty || 0;
          const unit = (item.item && item.item.qtyType) ? item.item.qtyType.toLowerCase() : "units";
          return `${itemName} (${qty} ${unit})`;
        }).join(", ") : "No items shared";

        // Return the HTML for this match
        return `
          <li class="match-item">
            <div class="match-header">
              <strong>${userName}</strong> (${distance} km away)
            </div>
            <div class="match-details">
              <p><strong>Contact:</strong> ${contact}</p>
              <p><strong>They have:</strong> ${theirShareItems}</p>
              <button class="btn-contact" onclick="contactMatch('${userName}', '${contact}')">
                Contact ${userName}
              </button>
            </div>
          </li>
        `;
      }).join("");
    }

    // Helper function to handle contacting a match
    function contactMatch(userName, contact) {
      // In a real app, this could open a chat interface or email form
      // For now, we'll just copy their contact info to clipboard and show an alert
      try {
        navigator.clipboard.writeText(contact).then(() => {
          showStatus(`Contact info for ${userName} copied to clipboard!`, true);
        }).catch(err => {
          console.error('Failed to copy contact info:', err);
          showStatus(`Contact ${userName} at: ${contact}`, true);
        });
      } catch (e) {
        // Fallback for browsers that don't support clipboard API
        showStatus(`Contact ${userName} at: ${contact}`, true);
      }
    }

    // Find Matches button handler
    document.querySelector(".find-matches").addEventListener("click", async () => {
      try {
        document.querySelector(".find-matches").innerHTML = "Finding Matches... <span class='loading'></span>";
        document.getElementById("matchResults").innerHTML = "<li>Searching for matches...</li>";

        const response = await fetch(`${API_BASE_URL}/matches/${username}`);
        document.querySelector(".find-matches").innerHTML = "Find Matches!";

        if (response.ok) {
          const matches = await response.json();
          displayMatches(matches);

          if (matches.length > 0) {
            showStatus("Found matches in your area!", true);
          } else {
            showStatus("No matches found in your area.", false);
          }
        } else {
          document.getElementById("matchResults").innerHTML = "<li>No matches found in your area.</li>";
        }
      } catch (error) {
        console.error("Error finding matches:", error);
        document.querySelector(".find-matches").innerHTML = "Find Matches!";
        document.getElementById("matchResults").innerHTML = "<li>Error connecting to match service.</li>";
        showStatus("Error finding matches.", false);
      }
    });

    // Modal handlers
    document.querySelector(".createPostButton").addEventListener("click", () => {
      document.getElementById("createPostModal").classList.remove("hidden");
      document.getElementById("createPostModal").classList.add("visible");
    });

    document.querySelector(".close-modal").addEventListener("click", () => {
      document.getElementById("createPostModal").classList.remove("visible");
      document.getElementById("createPostModal").classList.add("hidden");
    });

    document.querySelector(".createPostButton2").addEventListener("click", () => {
      document.getElementById("createPostModal2").classList.remove("hidden");
      document.getElementById("createPostModal2").classList.add("visible");
    });

    document.querySelector(".close-modal2").addEventListener("click", () => {
      document.getElementById("createPostModal2").classList.remove("visible");
      document.getElementById("createPostModal2").classList.add("hidden");
    });

    // Handle want list form submission
    document.getElementById("postForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const item = document.getElementById("foodName").value;
      const qty = parseFloat(document.getElementById("quantity").value);
      const qtyType = document.getElementById("units").value;

      try {
        const response = await fetch(`${API_BASE_URL}/wantlist`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            username: username,
            item: {
              name: item,
              qtyType: qtyType
            },
            qty: qty
          })
        });

        if (response.ok) {
          // Use the old way of hiding the modal
          document.getElementById("createPostModal").classList.remove("visible");
          document.getElementById("createPostModal").classList.add("hidden");
          document.getElementById("foodName").value = "";
          document.getElementById("quantity").value = "1";
          document.getElementById("units").value = "UNIT";

          // Show success message
          showStatus(`Added ${item} to your want list!`, true);

          // Reload lists
          loadLists();
        } else {
          showStatus("Failed to add item to want list", false);
        }
      } catch (error) {
        console.error("Error adding to want list:", error);
        showStatus("Error connecting to the server", false);
      }
    });

    // Handle share list form submission
    document.getElementById("postForm2").addEventListener("submit", async (e) => {
      e.preventDefault();
      const item = document.getElementById("foodName2").value;
      const qty = parseFloat(document.getElementById("quantity2").value);
      const qtyType = document.getElementById("units2").value;
      const expirationDate = document.getElementById("expiryDate2").value;

      try {
        const response = await fetch(`${API_BASE_URL}/sharelist`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            username: username,
            item: {
              name: item,
              qtyType: qtyType
            },
            qty: qty,
            expirationDate: expirationDate
          })
        });

        if (response.ok) {
          // Use the old way of hiding the modal
          document.getElementById("createPostModal2").classList.remove("visible");
          document.getElementById("createPostModal2").classList.add("hidden");
          document.getElementById("foodName2").value = "";
          document.getElementById("quantity2").value = "";
          document.getElementById("expiryDate2").value = "";
          document.getElementById("units2").value = "UNIT";

          // Show success message
          showStatus(`Added ${item} to your share list!`, true);

          // Reload lists
          loadLists();
        } else {
          showStatus("Failed to add item to share list", false);
        }
      } catch (error) {
        console.error("Error adding to share list:", error);
        showStatus("Error connecting to the server", false);
      }
    });

      shareListElement.innerHTML = shareList.map(item => {
        const itemName = item.item ? item.item.name : "Unknown item";
        const qty = item.qty || 0;
        const unit = (item.item && item.item.qtyType) ? item.item.qtyType.toLowerCase() : "units";
        const date = item.expirationDate ? new Date(item.expirationDate).toLocaleDateString() : "No expiry";

        return `<li>${itemName} - ${qty} ${unit} (Expires: ${date})
    <button class="delete-button-share" data-item-name="${item.item.name}">&#x274c;</button>
  </li>`;
      }).join("");

      const deleteButtons = document.querySelectorAll('.delete-button-share');
      deleteButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          const itemName = e.target.getAttribute('data-item-name');
          const modal = document.getElementById('delete-modal');
          const modalItemName = document.getElementById('modal-item-name');
          const confirmDeleteButton = document.getElementById('confirm-delete');
          const cancelDeleteButton = document.getElementById('cancel-delete');

          modalItemName.textContent = `Are you sure you want to delete ${itemName}?`;

          modal.classList.add('visible');

          confirmDeleteButton.onclick = async () => {
            try {
              const response = await fetch(`${API_BASE_URL}/sharelist`, {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  username: username,
                  item: { name: itemName },
                }),
              });

              if (response.ok) {
                console.log(`${itemName} deleted successfully.`);
                e.target.closest('li').remove();
              } else {
                console.log(`Error deleting ${itemName}`);
              }
            } catch (error) {
              console.error('Error:', error);
            }
            // Close the modal after the action
            modal.classList.remove('visible');
          };

          cancelDeleteButton.onclick = () => {
            modal.classList.remove('visible');
          };
        });
      });
      }
  </script>
</body>

</html>